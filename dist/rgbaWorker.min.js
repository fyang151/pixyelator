onmessage=t=>{const[e,a,o,s=!1]=t.data;try{const t=new OffscreenCanvas(e.width,e.height).getContext("2d",{willReadFrequently:!0});t.drawImage(e,0,0);const l=new OffscreenCanvas(a,o),r=l.getContext("2d"),f=e.width/a,h=e.height/o;for(let e=0;e<o;e++)for(let o=0;o<a;o++){const a=Math.floor(o*f),l=Math.floor(e*h),n=Math.floor((o+1)*f)-a,g=Math.floor((e+1)*h)-l,c=t.getImageData(a,l,n,g).data,M=c.length/4;let i=0,d=0,m=0,w=0;for(let t=0;t<c.length;t+=4)i+=c[t],d+=c[t+1],m+=c[t+2],w+=c[t+3];i=Math.floor(i/M),d=Math.floor(d/M),m=Math.floor(m/M),w=Math.floor(w/M)/255,s&&(i=d=m=Math.floor(.299*i+.587*d+.114*m)),r.fillStyle=`rgba(${i}, ${d}, ${m}, ${w})`,r.fillRect(o,e,1,1)}const n=l.transferToImageBitmap();self.postMessage({success:!0,bitmap:n},[n])}catch(t){self.postMessage({success:!1,error:t.message})}};